<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Admin Order Dashboard</h1>
        <p class="subtitle">View and manage all client orders.</p>
        <div class="controls">
            <input type="password" id="adminSecret" placeholder="Enter Admin Secret">
            <button id="fetchOrdersBtn">Fetch All Orders</button>
        </div>
        <div id="status"></div>
        <table>
            <thead><tr><th>Order ID</th><th>Username</th><th>Date</th><th>Phone</th><th>Plan</th><th>Amount (GHS)</th><th>Status</th></tr></thead>
            <tbody id="ordersTableBody"></tbody>
        </table>
    </div>
    <script>
        document.getElementById('fetchOrdersBtn').addEventListener('click', async () => {
            const secret = document.getElementById('adminSecret').value;
            const statusDiv = document.getElementById('status');
            const tableBody = document.getElementById('ordersTableBody');
            if (!secret) { statusDiv.textContent = 'Please enter the admin secret.'; statusDiv.style.color = 'red'; return; }
            
            statusDiv.textContent = 'Fetching all orders...';
            tableBody.innerHTML = '';
            try {
                const response = await fetch(`/api/get-all-orders?secret=${secret}`);
                if (!response.ok) throw new Error('Failed to fetch. Check secret or server logs.');
                const { orders } = await response.json();
                if (!orders.length) { statusDiv.textContent = 'No orders found.'; return; }
                
                statusDiv.textContent = `Displaying ${orders.length} total orders.`;
                statusDiv.style.color = 'green';
                orders.forEach(order => {
                    const row = tableBody.insertRow();
                    const statusClass = `status-${order.status}`;
                    row.innerHTML = `
                        <td>${order.id}</td>
                        <td>${order.username}</td>
                        <td>${new Date(order.created_at).toLocaleString('en-GB')}</td>
                        <td>${order.phone_number}</td>
                        <td>${order.data_plan}</td>
                        <td>${order.amount.toFixed(2)}</td>
                        <td><span class="status-span ${statusClass}">${order.status.replace('_', ' ')}</span></td>
                    `;
                });
            } catch (error) {
                statusDiv.textContent = error.message;
                statusDiv.style.color = 'red';
            }
        });
    </script>
</body>
</html>