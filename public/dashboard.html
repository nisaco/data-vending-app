<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="/purchase" class="nav-brand">DataLink</a>
            <div class="nav-menu">
                <a href="/dashboard" class="nav-link active">Dashboard</a>
                <a href="/api/logout" class="nav-link nav-link-logout">Logout</a>
            </div>
        </div>
    </nav>
    <div class="container">
        <h1>My Order History</h1>
        <p class="subtitle">Here are all the data purchases you've made.</p>
        <div id="status"></div>
        <table>
            <thead><tr><th>Date</th><th>Phone</th><th>Plan</th><th>Amount (GHS)</th><th>Status</th></tr></thead>
            <tbody id="ordersTableBody"></tbody>
        </table>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const statusDiv = document.getElementById('status');
            const tableBody = document.getElementById('ordersTableBody');
            statusDiv.textContent = 'Loading your orders...';
            try {
                const response = await fetch('/api/my-orders');
                if (!response.ok) throw new Error('Could not fetch orders. Please try logging in again.');
                const { orders } = await response.json();
                tableBody.innerHTML = '';
                if (!orders.length) { statusDiv.textContent = "You haven't made any purchases yet."; return; }
                statusDiv.textContent = '';
                orders.forEach(order => {
                    const row = tableBody.insertRow();
                    const statusClass = `status-${order.status}`;
                    row.innerHTML = `
                        <td>${new Date(order.created_at).toLocaleString('en-GB')}</td>
                        <td>${order.phone_number}</td>
                        <td>${order.data_plan}</td>
                        <td>${order.amount.toFixed(2)}</td>
                        <td><span class="status-span ${statusClass}">${order.status.replace('_', ' ')}</span></td>
                    `;
                });
            } catch (error) {
                statusDiv.textContent = error.message;
                statusDiv.style.color = 'red';
            }
        });
    </script>
</body>
</html>